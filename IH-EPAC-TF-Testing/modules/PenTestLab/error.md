 Error: local-exec provisioner error
│ 
│   with azurerm_linux_virtual_machine.kali_vm,
│   on main.tf line 190, in resource "azurerm_linux_virtual_machine" "kali_vm":
│  190:   provisioner "local-exec" {
│ 
│ Error running command '      az vm extension set \
│         --resource-group pentest-lab-rg \
│         --vm-name pentest-lab-kali01 \
│         --name AADSSHLoginForLinux \
│         --publisher Microsoft.Azure.ActiveDirectory
│ ': exit status 1. Output: ERROR: (VMExtensionHandlerNonTransientError) The handler for VM extension type
│ 'Microsoft.Azure.ActiveDirectory.AADSSHLoginForLinux' has reported terminal failure for VM extension 'AADSSHLoginForLinux' with error message:
│ '[ExtensionOperationError] Non-zero exit code: 100, /var/lib/waagent/Microsoft.Azure.ActiveDirectory.AADSSHLoginForLinux-1.0.3048.1/./installer.sh install
│ [stdout]
│ Machine OS: kali v2024.2 x86_64
│ Installing...
│ Stopping apt-daily.timer
│ Stopping apt-daily-upgrade.timer
│ Failing to refresh repos; ignoring
│ Installing curl
│ Reading package lists...
│ Building dependency tree...
│ Reading state information...
│ Starting apt-daily-upgrade.timer
│ Starting apt-daily.timer
│ 
│ 
│ [stderr]
│ W: GPG error: http://kali.download/kali kali-rolling InRelease: The following signatures couldn't be verified because the public key is not available:
│ NO_PUBKEY ED65462EC8D5E4C5
│ E: The repository 'http://kali.download/kali kali-rolling InRelease' is not signed.
│ E: Unable to locate package curl
│ Failed to install curl. To get more info, try to run on the VM: sudo apt-get install -q -y -o Dpkg::Options::=--force-confold curl
│ '.
│     
│ 'Install handler failed for the extension. More information on troubleshooting is available at https://aka.ms/vmextensionlinuxtroubleshoot'
│ Code: VMExtensionHandlerNonTransientError
│ Message: The handler for VM extension type 'Microsoft.Azure.ActiveDirectory.AADSSHLoginForLinux' has reported terminal failure for VM extension
│ 'AADSSHLoginForLinux' with error message: '[ExtensionOperationError] Non-zero exit code: 100,
│ /var/lib/waagent/Microsoft.Azure.ActiveDirectory.AADSSHLoginForLinux-1.0.3048.1/./installer.sh install
│ [stdout]
│ Machine OS: kali v2024.2 x86_64
│ Installing...
│ Stopping apt-daily.timer
│ Stopping apt-daily-upgrade.timer
│ Failing to refresh repos; ignoring
│ Installing curl
│ Reading package lists...
│ Building dependency tree...
│ Reading state information...
│ Starting apt-daily-upgrade.timer
│ Starting apt-daily.timer
│ 
│ 
│ [stderr]
│ W: GPG error: http://kali.download/kali kali-rolling InRelease: The following signatures couldn't be verified because the public key is not available:
│ NO_PUBKEY ED65462EC8D5E4C5
│ E: The repository 'http://kali.download/kali kali-rolling InRelease' is not signed.
│ E: Unable to locate package curl
│ Failed to install curl. To get more info, try to run on the VM: sudo apt-get install -q -y -o Dpkg::Options::=--force-confold curl
│ '.
│     
│ 'Install handler failed for the extension. More information on troubleshooting is available at https://aka.ms/vmextensionlinuxtroubleshoot'
│ 
╵
╷
│ Error: updating identity for Linux Virtual Machine (Subscription: "a56e96ca-e13f-4644-8a02-0de858986c17"
│ Resource Group Name: "pentest-lab-rg"
│ Virtual Machine Name: "pentest-lab-rhel"): performing CreateOrUpdate: unexpected status 400 (400 Bad Request) with error: MismatchingNestedResourceSegments: The resource with name 'AADSSHLoginForLinux' and type 'Microsoft.Compute/virtualMachines/extensions' has incorrect segment lengths. A nested resource type must have identical number of segments as its resource name. A root resource type must have segment length one greater than its resource name. Please see https://aka.ms/arm-template/#resources for usage details.
│ 
│   with azurerm_linux_virtual_machine.rhel_vm,
│   on main.tf line 286, in resource "azurerm_linux_virtual_machine" "rhel_vm":
│  286: resource "azurerm_linux_virtual_machine" "rhel_vm" {